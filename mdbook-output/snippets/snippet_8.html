<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Snippet 8 - Rust Notes App</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Rust Notes App</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="snippet-8-create-new-users"><a class="header" href="#snippet-8-create-new-users">Snippet 8: Create New Users</a></h1>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>pub fn create_user(&amp;mut self, username: String, password: &amp;str) -&gt; Result&lt;()&gt; {
    // Validate input
    if username.trim().is_empty() {
        return Err(anyhow!("Username cannot be empty"));
    }

    if username.len() &lt; 3 {
        return Err(anyhow!("Username must be at least 3 characters long"));
    }

    if username.len() &gt; 50 {
        return Err(anyhow!("Username must be less than 50 characters"));
    }

    // Check for invalid characters
    if !username
        .chars()
        .all(|c| c.is_alphanumeric() || c == '_' || c == '-')
    {
        return Err(anyhow!(
            "Username can only contain letters, numbers, underscores, and hyphens"
        ));
    }

    if password.len() &lt; 6 {
        return Err(anyhow!("Password must be at least 6 characters long"));
    }

    if password.len() &gt; 128 {
        return Err(anyhow!("Password must be less than 128 characters"));
    }

    // Check if user already exists (case-insensitive)
    let username_lower = username.to_lowercase();
    if self
        .users
        .keys()
        .any(|k| k.to_lowercase() == username_lower)
    {
        return Err(anyhow!("Username already exists"));
    }

    // Create the user
    let user = User::new(username.clone(), password)?;
    self.users.insert(username, user);
    self.save_users()?;

    println!("Successfully created user account");
    Ok(())
}
<span class="boring">}</span></code></pre></pre>
<h2 id="comprehensive-user-registration-system-with-advanced-validation"><a class="header" href="#comprehensive-user-registration-system-with-advanced-validation">Comprehensive User Registration System with Advanced Validation</a></h2>
<p>This function implements a robust user account creation system that combines comprehensive input validation, security best practices, and user experience considerations. It serves as the gateway for new users entering the system and establishes the foundation for secure, long-term user account management.</p>
<h3 id="detailed-registration-architecture-analysis"><a class="header" href="#detailed-registration-architecture-analysis">Detailed Registration Architecture Analysis</a></h3>
<p><strong>Function Signature and Security Design:</strong></p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>pub fn create_user(&amp;mut self, username: String, password: &amp;str) -&gt; Result&lt;()&gt;
<span class="boring">}</span></code></pre></pre>
<p>The function signature reflects several important security and design decisions:</p>
<ul>
<li><strong>Mutable Self Reference</strong>: Uses <code>&amp;mut self</code> to allow modification of the user registry</li>
<li><strong>Owned Username</strong>: Takes ownership of the username string to avoid lifetime complications</li>
<li><strong>Borrowed Password</strong>: Uses string slice for password to avoid unnecessary allocations</li>
<li><strong>Result Return</strong>: Provides comprehensive error handling with descriptive error messages</li>
<li><strong>Unit Return</strong>: Returns <code>()</code> on success, focusing on the side effect of user creation</li>
</ul>
<p><strong>Username Validation Framework:</strong>
The function implements a comprehensive username validation system that balances security, usability, and system requirements:</p>
<p><strong>Empty Username Prevention:</strong></p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>if username.trim().is_empty() {
    return Err(anyhow!("Username cannot be empty"));
}
<span class="boring">}</span></code></pre></pre>
<p>This validation step provides several benefits:</p>
<ul>
<li><strong>Whitespace Handling</strong>: Uses <code>trim()</code> to handle usernames that are only whitespace</li>
<li><strong>User Experience</strong>: Provides clear, actionable error messages</li>
<li><strong>Data Integrity</strong>: Prevents empty usernames from entering the system</li>
<li><strong>Early Validation</strong>: Fails fast on obviously invalid input</li>
</ul>
<p><strong>Minimum Length Requirements:</strong></p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>if username.len() &lt; 3 {
    return Err(anyhow!("Username must be at least 3 characters long"));
}
<span class="boring">}</span></code></pre></pre>
<p>The minimum length requirement serves multiple purposes:</p>
<ul>
<li><strong>Usability</strong>: Ensures usernames are long enough to be meaningful and memorable</li>
<li><strong>Uniqueness</strong>: Longer usernames reduce the likelihood of conflicts</li>
<li><strong>Security</strong>: Prevents extremely short usernames that might be easier to guess</li>
<li><strong>System Consistency</strong>: Establishes consistent expectations across the application</li>
</ul>
<p><strong>Maximum Length Constraints:</strong></p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>if username.len() &gt; 50 {
    return Err(anyhow!("Username must be less than 50 characters"));
}
<span class="boring">}</span></code></pre></pre>
<p>The maximum length constraint provides several benefits:</p>
<ul>
<li><strong>Database Efficiency</strong>: Prevents excessively long usernames that could impact database performance</li>
<li><strong>UI Consistency</strong>: Ensures usernames fit properly in user interface elements</li>
<li><strong>Memory Management</strong>: Prevents potential memory exhaustion attacks</li>
<li><strong>Display Compatibility</strong>: Ensures usernames display properly across different contexts</li>
</ul>
<p><strong>Character Set Validation:</strong></p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>if !username.chars().all(|c| c.is_alphanumeric() || c == '_' || c == '-') {
    return Err(anyhow!("Username can only contain letters, numbers, underscores, and hyphens"));
}
<span class="boring">}</span></code></pre></pre>
<p>The character restriction system implements several important considerations:</p>
<ul>
<li><strong>Cross-Platform Compatibility</strong>: Ensures usernames work across different operating systems and file systems</li>
<li><strong>URL Safety</strong>: Allows usernames to be safely used in URLs without encoding</li>
<li><strong>Security</strong>: Prevents injection attacks and special character exploits</li>
<li><strong>Internationalization</strong>: Uses <code>is_alphanumeric()</code> to support Unicode letters and numbers</li>
<li><strong>Readability</strong>: Restricts to characters that are easily readable and typeable</li>
</ul>
<p><strong>Password Security Validation:</strong>
The password validation system balances security requirements with user experience:</p>
<p><strong>Minimum Password Length:</strong></p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>if password.len() &lt; 6 {
    return Err(anyhow!("Password must be at least 6 characters long"));
}
<span class="boring">}</span></code></pre></pre>
<p>The minimum length requirement provides:</p>
<ul>
<li><strong>Basic Security</strong>: Ensures passwords have minimum entropy</li>
<li><strong>Brute Force Resistance</strong>: Makes brute force attacks more difficult</li>
<li><strong>User Guidance</strong>: Educates users about password security requirements</li>
<li><strong>Compliance</strong>: Meets basic security standards for password complexity</li>
</ul>
<p><strong>Maximum Password Length:</strong></p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>if password.len() &gt; 128 {
    return Err(anyhow!("Password must be less than 128 characters"));
}
<span class="boring">}</span></code></pre></pre>
<p>The maximum length constraint serves several purposes:</p>
<ul>
<li><strong>DoS Prevention</strong>: Prevents denial-of-service attacks using extremely long passwords</li>
<li><strong>Memory Management</strong>: Limits memory usage during password hashing operations</li>
<li><strong>Performance</strong>: Ensures password hashing completes in reasonable time</li>
<li><strong>Practical Limits</strong>: 128 characters is far beyond typical user password lengths</li>
</ul>
<p><strong>Username Uniqueness Enforcement:</strong></p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let username_lower = username.to_lowercase();
if self.users.keys().any(|k| k.to_lowercase() == username_lower) {
    return Err(anyhow!("Username already exists"));
}
<span class="boring">}</span></code></pre></pre>
<p>The uniqueness checking system implements sophisticated collision detection:</p>
<ul>
<li><strong>Case-Insensitive Comparison</strong>: Prevents confusion between "User" and "user"</li>
<li><strong>Efficient Lookup</strong>: Uses iterator methods for optimal performance</li>
<li><strong>User Experience</strong>: Prevents user confusion from similar usernames</li>
<li><strong>Data Integrity</strong>: Ensures each username is truly unique in the system</li>
<li><strong>Security</strong>: Prevents username spoofing attacks using case variations</li>
</ul>
<p><strong>Secure User Account Creation:</strong></p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let user = User::new(username.clone(), password)?;
self.users.insert(username, user);
<span class="boring">}</span></code></pre></pre>
<p>The account creation process implements several security measures:</p>
<ul>
<li><strong>Secure Construction</strong>: Uses the <code>User::new()</code> constructor which handles password hashing</li>
<li><strong>Error Propagation</strong>: Handles any errors during user object creation</li>
<li><strong>Atomic Insertion</strong>: Adds the user to the registry only after successful creation</li>
<li><strong>Username Preservation</strong>: Maintains the original username casing for display purposes</li>
</ul>
<p><strong>Persistent Storage and Data Integrity:</strong></p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>self.save_users()?;
<span class="boring">}</span></code></pre></pre>
<p>The persistence operation ensures data durability:</p>
<ul>
<li><strong>Immediate Persistence</strong>: Saves the updated user registry immediately</li>
<li><strong>Atomic Operations</strong>: Ensures the save operation completes successfully or fails cleanly</li>
<li><strong>Data Consistency</strong>: Maintains consistency between memory and persistent storage</li>
<li><strong>Error Handling</strong>: Propagates storage errors for appropriate handling</li>
</ul>
<p><strong>Success Confirmation and Logging:</strong></p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>println!("Successfully created user account");
Ok(())
<span class="boring">}</span></code></pre></pre>
<p>The completion process provides important feedback:</p>
<ul>
<li><strong>Operation Confirmation</strong>: Confirms successful account creation</li>
<li><strong>Audit Trail</strong>: Creates a log entry for security monitoring</li>
<li><strong>User Feedback</strong>: Could be enhanced to provide user-facing confirmation</li>
<li><strong>Success Return</strong>: Returns <code>Ok(())</code> to indicate successful completion</li>
</ul>
<p><strong>Security Considerations and Best Practices:</strong>
The registration system implements several security best practices:</p>
<p><strong>Input Sanitization:</strong></p>
<ul>
<li><strong>Comprehensive Validation</strong>: Validates all input parameters thoroughly</li>
<li><strong>Early Rejection</strong>: Rejects invalid input before processing</li>
<li><strong>Clear Error Messages</strong>: Provides actionable feedback without leaking system information</li>
<li><strong>Consistent Validation</strong>: Applies the same validation rules consistently</li>
</ul>
<p><strong>Attack Prevention:</strong></p>
<ul>
<li><strong>Username Enumeration</strong>: Generic error messages prevent username enumeration attacks</li>
<li><strong>Resource Exhaustion</strong>: Length limits prevent resource exhaustion attacks</li>
<li><strong>Injection Prevention</strong>: Character restrictions prevent various injection attacks</li>
<li><strong>Collision Avoidance</strong>: Case-insensitive uniqueness prevents confusion attacks</li>
</ul>
<p><strong>Data Protection:</strong></p>
<ul>
<li><strong>Secure Password Handling</strong>: Passwords are immediately hashed and never stored in plaintext</li>
<li><strong>Memory Safety</strong>: Uses Rust's ownership system to prevent memory-related vulnerabilities</li>
<li><strong>Atomic Operations</strong>: Ensures data consistency during account creation</li>
<li><strong>Error Recovery</strong>: Provides clean error recovery without leaving partial state</li>
</ul>
<p><strong>Performance and Scalability:</strong>
The registration system is designed for both performance and scalability:</p>
<p><strong>Efficient Operations:</strong></p>
<ul>
<li><strong>O(n) Uniqueness Check</strong>: Linear time complexity for username checking</li>
<li><strong>Minimal Allocations</strong>: Efficient memory usage during validation</li>
<li><strong>Fast Validation</strong>: Quick rejection of invalid input</li>
<li><strong>Optimized Storage</strong>: Efficient data structures for user storage</li>
</ul>
<p><strong>Scalability Considerations:</strong></p>
<ul>
<li><strong>Memory Efficiency</strong>: Reasonable limits on username and password length</li>
<li><strong>Storage Optimization</strong>: Efficient serialization and storage of user data</li>
<li><strong>Concurrent Safety</strong>: Thread-safe operations for multi-user environments</li>
<li><strong>Resource Management</strong>: Proper cleanup and resource management</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../snippets/snippet_7.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../snippets/snippet_9.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../snippets/snippet_7.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../snippets/snippet_9.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
